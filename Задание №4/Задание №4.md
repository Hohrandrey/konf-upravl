# Задание №4
  
  Разработать ассемблер и интерпретатор для учебной виртуальной машины
Разработать ассемблер и интерпретатор для учебной виртуальной машины
(УВМ). Система команд УВМ представлена далее.

  Для ассемблера необходимо разработать читаемое представление команд
Для ассемблера необходимо разработать читаемое представление команд
УВМ. Ассемблер принимает на вход файл с текстом исходной программы, путь к
которой задается из командной строки. Результатом работы ассемблера является
бинарный файл в виде последовательности байт, путь к которому задается из
командной строки. Дополнительный ключ командной строки задает путь к файлулогу, в котором хранятся ассемблированные инструкции в духе списков
“ключ=значение”, как в приведенных далее тестах.

  Интерпретатор принимает на вход бинарный файл, выполняет команды УВМ
Интерпретатор принимает на вход бинарный файл, выполняет команды УВМ
и сохраняет в файле-результате значения из диапазона памяти УВМ. Диапазон
также указывается из командной строки.

  Форматом для файла-лога и файла-результата является **json**.
  
  Необходимо реализовать приведенные тесты для всех команд, а также
написать и отладить тестовую программу.
  **Загрузка константы**
  
![](https://github.com/Hohrandrey/konf-upravl/blob/main/Задание%20№4/screens/Загрузка%20константы.png)

Форматом для файла-лога и файла-результата является json.

  Размер команды: 7 байт. Операнд: поле C. Результат: регистр по адресу,
которым является поле B.

  Тест (A=27, B=2, C=426):
  0x5B, 0x54, 0x03, 0x00, 0x00, 0x00, 0x00
  
  **Чтение значения из памяти**
  
![](https://github.com/Hohrandrey/konf-upravl/blob/main/Задание%20№4/screens/Чтение%20значения%20из%20памяти.png)
  
  Размер команды: 7 байт. Операнд: значение в памяти по адресу, которым
является сумма адреса (регистр по адресу, которым является поле C) и смещения
(поле D). Результат: регистр по адресу, которым является поле B.
Необходимо реализовать приведенные тесты для всех команд, а также
написать и отладить тестовую программу.

  Тест (A=3, B=3, C=13, D=286):
**Загрузка константы**

  0x63, 0xDA, 0x23, 0x00, 0x00, 0x00, 0x00
  
  **Запись значения в память**
  
![](https://github.com/Hohrandrey/konf-upravl/blob/main/Задание%20№4/screens/Запись%20значения%20в%20память.png)

Размер команды: 5 байт. Операнд: поле B. Результат: регистр-аккумулятор.
Тест (A=14, B=129):
0x2E, 0x10, 0x00, 0x00, 0x00

  Размер команды: 7 байт. Операнд: регистр по адресу, которым является поле
B. Результат: значение в памяти по адресу, которым является поле C.
  
  Тест (A=11, B=4, C=312):
  
  0x8B, 0x70, 0x02, 0x00, 0x00, 0x00, 0x00
  
  **Унарная операция: sqrt()**
  
![](https://github.com/Hohrandrey/konf-upravl/blob/main/Задание%20№4/screens/Унарная%20операция.png)
Размер команды: 3 байт. Операнд: значение в памяти по адресу, которым
является поле B. Результат: регистр-аккумулятор.
Тест (A=25, B=10):
0x59, 0x01, 0x00

  Размер команды: 7 байт. Операнд: значение в памяти по адресу, которым
является сумма адреса (регистр по адресу, которым является поле B) и смещения
(поле D). Результат: значение в памяти по адресу, которым является поле C.

**Запись значения в память**

  Тест (A=19, B=11, C=937, D=390):
Размер команды: 3 байт. Операнд: регистр-аккумулятор. Результат: значение
в памяти по адресу, которым является поле B.
Тест (A=15, B=761):
0x2F, 0x5F, 0x00
Бинарная операция: min()

  0x73, 0x53, 0x07, 0x00, 0x00, 0x86, 0x01
Размер команды: 3 байт. Первый операнд: регистр-аккумулятор. Второй
операнд: значение в памяти по адресу, которым является поле B. Результат:
регистр-аккумулятор.
Тест (A=20, B=935):
0xF4, 0x74, 0x00

  **Тестовая программа**

  Выполнить поэлементно операцию sqrt() над вектором длины 8. Результат
записать в новый вектор.

# Установка

Перед началом работы с программой требуется скачать репозиторий и необходимые библиотеки.

Клонирование репозитория:
```Bash
git clone https://github.com/Hohrandrey/konf-upravl/tree/main/Задание%20№4
```

Скачивание библиотеки [pytest](https://github.com/pytest-dev/pytest) путём запуска файла [script.sh](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/script.sh):
```Bash
script.sh
```



# Запуск

Запуск [assembler.py](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/assembler.py):
```Bash
 py .\assembler.py .\program.asm bin.bin -l log.json
```

Запуск [interpreter.py](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/interpreter.py):
```Bash
py .\interpreter.py bin.bin res.json 0:100
```

Запуск [pytest_assembler.py](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/pytest_assembler.py):
```Bash
pytest -v pytest_assembler.py
```

Запуск [pytest_interpreter.py](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/pytest_interpreter.py):
```Bash
pytest -v pytest_interpreter.py
```

# Тесты

## Тесты тестовой программы

### [Тестовая программа](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/k4/program.asm)

**Входные данные:**

**A** = (2, 3, 4, 5, 6, 7, 2, 1)

**B** = (3, 2, 5, 3, 2, 1, 6, 7)

**Выходные данные:**

**A** = (2, 3, 4, 5, 6, 7, 2, 1)

**B** = (3, 2, 5, 3, 2, 1, 6, 7)

**C** = (3, 2, 5, 3, 2, 1, 6, 7)

```
LOAD 27 0 2
LOAD 27 1 3
LOAD 27 2 4
LOAD 27 3 5
LOAD 27 4 6
LOAD 27 5 7
LOAD 27 6 2
LOAD 27 7 1

LOAD 27 8 3
LOAD 27 9 2
LOAD 27 10 5
LOAD 27 11 3
LOAD 27 12 2
LOAD 27 13 1
LOAD 27 14 6
LOAD 27 15 7

SQRT 19 0 16 6
SQRT 19 1 17 6
SQRT 19 2 18 6
SQRT 19 3 19 6
SQRT 19 4 20 6
SQRT 19 5 21 6
SQRT 19 6 22 12
SQRT 19 7 23 14
```


### Файл-результат

```
[
    {
        "address": 0,
        "value": 2
    },
    {
        "address": 1,
        "value": 3
    },
    {
        "address": 2,
        "value": 4
    },
    {
        "address": 3,
        "value": 5
    },
    {
        "address": 4,
        "value": 6
    },
    {
        "address": 5,
        "value": 7
    },
    {
        "address": 6,
        "value": 2
    },
    {
        "address": 7,
        "value": 1
    },
    {
        "address": 8,
        "value": 3
    },
    {
        "address": 9,
        "value": 2
    },
    {
        "address": 10,
        "value": 5
    },
    {
        "address": 11,
        "value": 3
    },
    {
        "address": 12,
        "value": 2
    },
    {
        "address": 13,
        "value": 1
    },
    {
        "address": 14,
        "value": 6
    },
    {
        "address": 15,
        "value": 7
    },
    {
        "address": 16,
        "value": 3
    },
    {
        "address": 17,
        "value": 2
    },
    {
        "address": 18,
        "value": 5
    },
    {
        "address": 19,
        "value": 3
    },
    {
        "address": 20,
        "value": 2
    },
    {
        "address": 21,
        "value": 1
    },
    {
        "address": 22,
        "value": 6
    },
    {
        "address": 23,
        "value": 7
    }
]
```

### Результаты pytest_assembler

![](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/screens/test_assembler.png)

### Результаты pytest_interpreter

![](https://github.com/Hohrandrey/konf-upravl/blob/main/%D0%97%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%E2%84%964/screens/test_interpreter.png)
